# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É WakeBot –Ω–∞ CMC DEX API v4

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

WakeBot —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ CMC DEX API v4. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ.

---

## üì¶ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
pip install -r requirements.txt

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
# - requests>=2.32.3
# - python-dotenv>=1.0.1
# - urllib3>=2.2.2
# - pytest>=8.3.3
```

---

## üîë 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```bash
# CMC API –∫–ª—é—á (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
export CMC_API_KEY=your_cmc_api_key_here
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```bash
# –°–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (default: ethereum)
export CHAINS=base,solana,ethereum,bsc

# –ò—Å—Ç–æ—á–Ω–∏–∫–∏ discovery (default: new,trending,pools,dexes)
export CMC_SOURCES=new,trending

# –ü–æ—Ä–æ–≥ data-quality –ø—Ä–æ–≤–µ—Ä–∫–∏ (default: 0.25)
export DQ_DISCREPANCY_THRESHOLD=0.25

# Fallback –Ω–∞ GeckoTerminal –ø—Ä–∏ —Å–±–æ–µ CMC (default: false)
export ALLOW_GT_OHLCV_FALLBACK=false

# Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤)
export TG_BOT_TOKEN=your_bot_token
export TG_CHAT_ID=your_chat_id
```

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–º. –≤ `wakebot/config.py`

---

## ‚úÖ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### 3.1. –û—Ñ–ª–∞–π–Ω –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞

```bash
python3 -m wakebot.main --health
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
[health] chains: ethereum - OK
[health] cmc_dex_base: https://pro-api.coinmarketcap.com/v4/dex - OK
[health] cmc_api_key: ***_key - OK
[health] cmc_calls_per_min: 28 - OK
[health] db_path: wake_state.sqlite - OK
[health] offline check: PASS
```

### 3.2. –û–Ω–ª–∞–π–Ω –ø—Ä–æ–≤–µ—Ä–∫–∞ CMC API

```bash
python3 -m wakebot.main --health-online
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
[health] debug discovery URL: https://pro-api.coinmarketcap.com/v4/dex/spot-pairs/latest?chain_slug=ethereum&category=all&page=1&limit=5
[health] discovery on ethereum/ethereum: OK
[health] ohlcv for <pair_id>: OK
[health] Result: PASS
```

### 3.3. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
python3 -m pytest tests/ -v
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
10 passed in 1.09s
```

---

## üéØ 4. –†–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞

### 4.1. –û–¥–∏–Ω —Ü–∏–∫–ª (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
python3 -m wakebot.main --once
```

–í—ã–ø–æ–ª–Ω–∏—Ç –æ–¥–∏–Ω —Ü–∏–∫–ª discovery + OHLCV + –∞–ª–µ—Ä—Ç—ã –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

### 4.2. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)

```bash
python3 -m wakebot
# –∏–ª–∏
python3 -m wakebot.main
```

–ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ü–∏–∫–ª—ã –∫–∞–∂–¥—ã–µ `LOOP_SECONDS` (default: 60).

### 4.3. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤

```bash
export MAX_CYCLES=5
python3 -m wakebot.main
```

–í—ã–ø–æ–ª–Ω–∏—Ç 5 —Ü–∏–∫–ª–æ–≤ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.

---

## üìä 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö

#### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ URL (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å):
```
https://pro-api.coinmarketcap.com/v4/dex/spot-pairs/latest?chain_slug=bnb&category=new&page=1&limit=100
https://pro-api.coinmarketcap.com/v4/dex/pairs/ohlcv/latest?chain_slug=ethereum&pair_address=0xABC&timeframe=1h&aggregate=1&limit=25
```

#### ‚ùå –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
https://api.coinmarketcap.com/...  # —Å—Ç–∞—Ä—ã–π —Ö–æ—Å—Ç
```

#### –õ–æ–≥–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å):
```
[discover][ethereum] pages: 2/2 (100%), candidates: 5, scanned: 200
[cycle] ethereum: scanned=200, candidates=5, ohlcv_probes=3, alerts=1
[rate] req=10 429=0 penalty=0.00s rps‚âà0.47
[rl:cmc] rps=0.467 tokens=0.47 p429%=0.0 conc=10
```

---

## üîß 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### Budget (OHLCV –ø—Ä–æ–≤–µ—Ä–∫–∏)

```bash
# –ú–∞–∫—Å–∏–º—É–º OHLCV –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —Ü–∏–∫–ª (default: 30)
export MAX_OHLCV_PROBES_CAP=30

# –ú–∏–Ω–∏–º—É–º OHLCV –∑–∞–ø—Ä–æ—Å–æ–≤ (default: 3)
export MIN_OHLCV_PROBES=3

# –†–µ–∑–µ—Ä–≤ –¥–ª—è CMC (default: 4)
export CMC_SAFETY_BUDGET=4
```

### Rate limiting

```bash
# CMC –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É (default: 28)
export CMC_CALLS_PER_MIN=28

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–∏ 429 (default: 3.0)
export CMC_RETRY_AFTER_CAP_S=3.0
```

### –§–∏–ª—å—Ç—Ä—ã

```bash
# –î–∏–∞–ø–∞–∑–æ–Ω –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (default: 50000-800000)
export LIQUIDITY_MIN=50000
export LIQUIDITY_MAX=800000

# –ú–∞–∫—Å–∏–º—É–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ 24—á (default: 2000)
export TX24H_MAX=2000
```

### –ê–ª–µ—Ä—Ç—ã

```bash
# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π ratio –¥–ª—è –∞–ª–µ—Ä—Ç–∞ (default: 1.0)
export ALERT_RATIO_MIN=1.0

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π prev24h volume (default: 1000)
export MIN_PREV24_USD=1000

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –ø—É–ª–∞ –≤ –¥–Ω—è—Ö (default: 7)
export REVIVAL_MIN_AGE_DAYS=7

# Cooldown –º–µ–∂–¥—É –∞–ª–µ—Ä—Ç–∞–º–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö (default: 30)
export COOLDOWN_MIN=30
```

---

## üêõ 7. Troubleshooting

### –û—à–∏–±–∫–∞: "API key missing"

```
[cmc] 401 error: {"error_message":"API key missing."}
```

**–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `CMC_API_KEY`:
```bash
export CMC_API_KEY=your_key_here
```

### –û—à–∏–±–∫–∞: "400 Bad Request"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ –ª–æ–≥–∞—Ö URL —Å–æ–¥–µ—Ä–∂–∏—Ç `category=...`:
```bash
python3 -m wakebot.main --once 2>&1 | grep "category="
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
?chain_slug=ethereum&category=new&page=1&limit=100
```

### –ù–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

```
[discover][ethereum] pages: 2/2 (100%), candidates: 0, scanned: 0
```

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ CMC API (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á)
2. –§–∏–ª—å—Ç—Ä—ã —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ (—É–≤–µ–ª–∏—á—å—Ç–µ `LIQUIDITY_MAX`, `TX24H_MAX`)
3. –í—Å–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –≤ seen-–∫—ç—à–µ (–ø–æ–¥–æ–∂–¥–∏—Ç–µ `SEEN_TTL_MIN` –º–∏–Ω—É—Ç)

---

## üìö 8. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `–ì–û–¢–û–í–û_CMC_V4.md` - –ü–æ–ª–Ω–æ–µ —Ä–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- `CMC_V4_MIGRATION_COMPLETE.md` - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `CMC_V4_CHECKLIST.md` - –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
- `FILES_CHANGED.txt` - –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
wakebot/
‚îú‚îÄ‚îÄ __init__.py        - –≠–∫—Å–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ __main__.py        - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è python -m wakebot
‚îú‚îÄ‚îÄ main.py            - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ (run_once, health checks)
‚îú‚îÄ‚îÄ config.py          - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ ENV
‚îú‚îÄ‚îÄ net_http.py        - HTTP –∫–ª–∏–µ–Ω—Ç —Å rate limiting
‚îú‚îÄ‚îÄ discovery.py       - Discovery –ø—É–ª–æ–≤ (CMC + GT)
‚îú‚îÄ‚îÄ cmc.py             - CMC OHLCV v4
‚îú‚îÄ‚îÄ alerts.py          - –õ–æ–≥–∏–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
‚îú‚îÄ‚îÄ storage.py         - SQLite —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îú‚îÄ‚îÄ filters.py         - –§–∏–ª—å—Ç—Ä—ã –ø—É–ª–æ–≤/—Ç–æ–∫–µ–Ω–æ–≤
‚îú‚îÄ‚îÄ gecko.py           - GeckoTerminal –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ rate_limit.py      - Adaptive rate limiter
```

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏: –∏—â–∏—Ç–µ `[cmc]`, `[health]`, `[discover]`
2. –¢–µ—Å—Ç—ã: `python3 -m pytest tests/ -v`
3. Health check: `python3 -m wakebot.main --health-online`

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –Ω–∞ CMC DEX API v4.

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞:**

```bash
export CMC_API_KEY=your_key_here
export CHAINS=base,solana,ethereum,bsc
python3 -m wakebot.main --once
```

–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è! üöÄ
