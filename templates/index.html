<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Response Aggregator</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: #121935;
      --text: #e6ecff;
      --muted: #9bb0ff;
      --accent: #6ea8fe;
      --green: #62d2a2;
      --red: #ff6b6b;
      --yellow: #ffd166;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
      background: linear-gradient(180deg, #0b1020 0%, #0f1430 100%);
      color: var(--text);
    }
    .container { max-width: 900px; margin: 0 auto; padding: 24px; }
    h1 { font-weight: 700; letter-spacing: 0.2px; margin: 0 0 12px; }
    p.sub { margin: 0 0 24px; color: var(--muted); }

    .card { background: var(--card); border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .row { display: flex; gap: 12px; align-items: flex-start; }
    textarea {
      flex: 1; min-height: 84px; resize: vertical;
      background: #0e1533; color: var(--text); border: 1px solid #2a3470; border-radius: 12px; padding: 12px;
      outline: none; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }
    button {
      background: var(--accent); color: #041224; border: 0; border-radius: 12px; padding: 12px 16px; font-weight: 700; cursor: pointer;
      transition: transform .05s ease-in-out, filter .2s ease;
    }
    button:disabled { filter: grayscale(0.6) brightness(0.7); cursor: not-allowed; }
    button:hover:not(:disabled) { transform: translateY(-1px); }

    .chat { margin-top: 18px; display: grid; gap: 12px; }
    .bubble { background: #0e1533; border: 1px solid #2a3470; border-radius: 14px; padding: 12px; }
    .from-user { border-color: #2e7ffe; }
    .from-ai { border-color: #2a3470; }

    .section-title { margin: 10px 0 6px; font-size: 14px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
    .model { margin: 4px 0 10px; }
    .model h4 { margin: 0 0 6px; font-size: 15px; display: flex; gap: 8px; align-items: center; }
    .badge { font-size: 11px; padding: 2px 6px; border-radius: 999px; background: #1a224e; color: var(--muted); border: 1px solid #2a3470; }
    .badge.rec { background: #143344; color: #a5ffd9; border-color: #1a5a4f; }
    .small { font-size: 13px; color: var(--muted); }
    .error { color: var(--red); }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI Response Aggregator</h1>
    <p class="sub">Ask a question and compare answers from ChatGPT (OpenAI), Grok (xAI), Gemini (Google), and DeepSeek. Then see their synthesized final answers.</p>

    <div class="card">
      <div class="row">
        <textarea id="question" placeholder="Ask anything... (e.g. Explain quantum entanglement in simple terms)"></textarea>
        <button id="askBtn">Ask</button>
      </div>
      <div class="small" id="hint">API calls run in parallel. Timeouts and errors are handled gracefully.</div>
      <div class="chat" id="chat"></div>
    </div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const askBtn = document.getElementById('askBtn');
    const questionEl = document.getElementById('question');

    function addBubble(text, cls = 'from-user') {
      const el = document.createElement('div');
      el.className = `bubble ${cls}`;
      el.textContent = text;
      chat.appendChild(el);
      el.scrollIntoView({ behavior: 'smooth', block: 'end' });
      return el;
    }

    function addSectionTitle(text) {
      const el = document.createElement('div');
      el.className = 'section-title';
      el.textContent = text;
      chat.appendChild(el);
      return el;
    }

    function addModelBlock(title, bodyText, isRecommended = false) {
      const wrap = document.createElement('div');
      wrap.className = 'model';
      const h4 = document.createElement('h4');
      h4.textContent = title;
      if (isRecommended) {
        const badge = document.createElement('span');
        badge.className = 'badge rec';
        badge.textContent = 'Recommended';
        h4.appendChild(document.createTextNode(' '));
        h4.appendChild(badge);
      }
      const body = document.createElement('div');
      body.textContent = bodyText;
      wrap.appendChild(h4);
      wrap.appendChild(body);
      chat.appendChild(wrap);
      return wrap;
    }

    async function ask() {
      const q = (questionEl.value || '').trim();
      if (!q) {
        addBubble('Please enter a question.', 'from-ai');
        return;
      }

      askBtn.disabled = true;
      const userBubble = addBubble(q, 'from-user');
      const thinking = addBubble('Gathering responses from models...', 'from-ai');

      try {
        const resp = await fetch('/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question: q }),
        });

        const data = await resp.json();
        thinking.remove();

        if (!resp.ok) {
          const msg = data && data.error ? data.error : 'Something went wrong';
          addBubble(msg, 'from-ai');
          return;
        }

        addSectionTitle('Initial responses');
        const models = data.models || { openai: 'OpenAI', xai: 'xAI', gemini: 'Gemini', deepseek: 'DeepSeek' };
        const initial = data.initial || {};
        addModelBlock(models.openai + ' \u2192 Initial', initial.openai || '(no response)');
        addModelBlock(models.xai + ' \u2192 Initial', initial.xai || '(no response)');
        addModelBlock(models.gemini + ' \u2192 Initial', initial.gemini || '(no response)');
        addModelBlock(models.deepseek + ' \u2192 Initial', initial.deepseek || '(no response)');

        addSectionTitle('Final synthesized responses');
        const final = data.final || {};
        const recommended = data.recommended || 'openai';
        addModelBlock(models.openai + ' \u2192 Final', final.openai || '(no response)', recommended === 'openai');
        addModelBlock(models.xai + ' \u2192 Final', final.xai || '(no response)', recommended === 'xai');
        addModelBlock(models.gemini + ' \u2192 Final', final.gemini || '(no response)', recommended === 'gemini');
        addModelBlock(models.deepseek + ' \u2192 Final', final.deepseek || '(no response)', recommended === 'deepseek');
      } catch (e) {
        thinking.remove();
        addBubble('Network or server error. Please try again.', 'from-ai');
      } finally {
        askBtn.disabled = false;
      }
    }

    askBtn.addEventListener('click', ask);
    questionEl.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        ask();
      }
    });
  </script>
</body>
</html>
